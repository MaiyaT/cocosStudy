{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "BoxDrop",
    "require",
    "BoxItem",
    "cc",
    "Class",
    "extends",
    "Component",
    "properties",
    "box_prefab",
    "default",
    "type",
    "Prefab",
    "num_rank",
    "tooltip",
    "num_row",
    "super_node",
    "Node",
    "onLoad",
    "Array",
    "prototype",
    "removeByValue",
    "arr",
    "val",
    "i",
    "length",
    "splice",
    "rankList",
    "itemWidth",
    "itemHeight",
    "itemSpace",
    "margin_top",
    "director",
    "getWinSize",
    "height",
    "margin_bottom",
    "margin_left",
    "margin_right",
    "boxPool",
    "NodePool",
    "creaePanleContent",
    "index",
    "createRankContent",
    "checkPanelEliminatable",
    "replayGame",
    "children",
    "boxDrop_destroy",
    "getComponent",
    "item",
    "shift",
    "console",
    "log",
    "rank_list",
    "origin_x",
    "box",
    "boxDrop_get",
    "active",
    "width",
    "box_c",
    "initBoxItem",
    "boxItem",
    "begin_x",
    "begin_y",
    "end_y",
    "rank",
    "row",
    "color_type",
    "random0To1",
    "resetOriginPos",
    "parent",
    "push",
    "updateAllRankEndY",
    "list_sub",
    "new_box",
    "item_box",
    "exchangeBoxItem",
    "boxItem1",
    "boxItem2",
    "toCheckViable",
    "list",
    "temp_endy",
    "temp_row",
    "temp_node",
    "list1",
    "list2",
    "temp_beginx",
    "temp_rank",
    "row_index",
    "isViable",
    "setTimeout",
    "bind",
    "wipe_list",
    "tempList",
    "pre_box",
    "j",
    "item_pre",
    "toAdd",
    "apply",
    "forEach",
    "elem",
    "boxIsSelectState",
    "isRepeatItemInWipe",
    "id",
    "size",
    "get",
    "instantiate",
    "node",
    "put"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "\r\n\r\nvar BoxDrop = require(\"BoxDrop\");\r\nvar BoxItem = require(\"BoxItem\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n\r\n        box_prefab:{\r\n            default:null,\r\n            type:cc.Prefab,\r\n        },\r\n\r\n        num_rank:{\r\n            default:10,\r\n            tooltip:\"列数\"\r\n        },\r\n\r\n        num_row:{\r\n            default:10,\r\n            tooltip:\"行数\"\r\n        },\r\n\r\n        super_node:{\r\n            default:null,\r\n            type:cc.Node,\r\n        },\r\n\r\n\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n\r\n        Array.prototype.removeByValue = function(arr,val){\r\n\r\n            for (var i = 0; i<arr.length; i++){\r\n                if(arr[i] === val){\r\n                    arr.splice(i,1);\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n\r\n        // Array.prototype.filterRepeat = function(){  \r\n        //     //直接定义结果数组  \r\n        //     var arr = [];\r\n        //     if(arr.length > 0){\r\n        //         arr.push(this[0]);\r\n        //     }\r\n\r\n        //     for(var i = 1; i < this.length; i++){    //从数组第二项开始循环遍历此数组  \r\n        //         //对元素进行判断：  \r\n        //         //如果数组当前元素在此数组中第一次出现的位置不是i  \r\n        //         //那么我们可以判断第i项元素是重复的，否则直接存入结果数组  \r\n        //         if(this.indexOf(this[i]) == i){  \r\n        //             arr.push(this[i]);  \r\n        //         }  \r\n        //     }  \r\n        //     return arr;  \r\n        // }  \r\n\r\n        this.rankList = [];\r\n\r\n        this.itemWidth = 100;\r\n        this.itemHeight = 100;\r\n\r\n        this.itemSpace = 5;\r\n\r\n        this.margin_top = (cc.director.getWinSize().height)*0.5 + this.itemHeight*0.5;\r\n        this.margin_bottom = -(cc.director.getWinSize().height)*0.5 - this.itemHeight*0.5;\r\n        this.margin_left =  -this.itemWidth*this.num_rank*0.5 + this.itemSpace*(this.num_rank*0.5-1);\r\n        this.margin_right = this.itemWidth*this.num_rank*0.5 - this.itemSpace*(this.num_rank*0.5-1);\r\n\r\n        //console.log(\"asds  \" + this.margin_top+\"  \"+this.margin_bottom);\r\n\r\n        this.boxPool = new cc.NodePool(\"BoxDrop\");\r\n\r\n        this.creaePanleContent();\r\n    },\r\n\r\n    //创建所有面板的数据\r\n    creaePanleContent:function(){\r\n\r\n        for(let index = 0; index<this.num_rank; index++){\r\n            this.createRankContent(index);\r\n        }\r\n\r\n        this.checkPanelEliminatable();\r\n    },\r\n\r\n    //重新开始游戏\r\n    replayGame:function(){\r\n\r\n        var children = this.super_node.children;\r\n\r\n        while(children.length > 0){\r\n            \r\n            for (var i = 0; i < children.length; ++i) {\r\n                this.boxDrop_destroy(children[i].getComponent(\"BoxDrop\"));\r\n            }            \r\n        }\r\n\r\n        //清空ranklist\r\n        var item;\r\n        while (item = this.rankList.shift()) {\r\n            \r\n        }\r\n        \r\n\r\n        console.log(\"清空成功\");\r\n\r\n        this.creaePanleContent();\r\n    },\r\n\r\n    //创建每一列的数据\r\n    createRankContent:function(index){\r\n\r\n        let rank_list = [];\r\n\r\n        let origin_x = this.margin_left + (this.itemWidth+this.itemSpace)*index;\r\n         \r\n        for(let i = 0; i < this.num_row; i++){\r\n\r\n            let box = this.boxDrop_get();\r\n            box.active = true;\r\n\r\n            box.width = this.itemWidth;\r\n            box.height = this.itemHeight;\r\n\r\n            let box_c = box.getComponent(\"BoxDrop\");\r\n            box_c.initBoxItem();\r\n\r\n            box_c.boxItem.begin_x = origin_x;\r\n            box_c.boxItem.begin_y = this.margin_top;\r\n            box_c.boxItem.end_y = this.margin_bottom + (this.itemHeight+this.itemSpace)*(i+1);\r\n            box_c.boxItem.rank = index;\r\n            box_c.boxItem.row = i;\r\n            box_c.boxItem.color_type = (cc.random0To1()*5) | 0;\r\n\r\n            box_c.resetOriginPos();\r\n\r\n            box.parent = this.super_node;\r\n\r\n            rank_list.push(box);\r\n        }\r\n\r\n        this.rankList.push(rank_list);\r\n    },\r\n\r\n    //更新某一列 end y的数据\r\n    updateAllRankEndY:function(){\r\n\r\n        //看该列的数量是否 小于 this.num_row  少于的话则补充\r\n        for(let i = 0; i<this.num_rank; i++){\r\n\r\n            let origin_x = this.margin_left + (this.itemWidth+this.itemSpace)*i;\r\n\r\n            let list_sub = this.rankList[i];\r\n            \r\n            while(list_sub.length < this.num_row){\r\n\r\n                let new_box = this.boxDrop_get();\r\n                new_box.active = true;\r\n\r\n                let box_c = new_box.getComponent(\"BoxDrop\");\r\n\r\n                box_c.boxItem.begin_x = origin_x;\r\n                box_c.boxItem.begin_y = this.margin_top;\r\n                box_c.boxItem.rank = i;\r\n                box_c.boxItem.row = 0;\r\n                box_c.boxItem.color_type = (cc.random0To1()*5) | 0;\r\n                box_c.resetOriginPos();\r\n\r\n                new_box.parent = this.super_node;\r\n\r\n                list_sub.push(new_box);\r\n            }\r\n\r\n\r\n\r\n\r\n            // let list = this.rankList[index];\r\n\r\n            //更新每个元素的end y 位置\r\n            for (let i = 0; i<list_sub.length; i++){\r\n\r\n                let item_box = list_sub[i];\r\n                let box_c = item_box.getComponent(\"BoxDrop\");\r\n\r\n                box_c.boxItem.row = i;\r\n                box_c.boxItem.end_y = this.margin_bottom + (this.itemHeight+this.itemSpace)*(i+1);\r\n            }\r\n        }\r\n\r\n        \r\n        this.checkPanelEliminatable();\r\n    },\r\n\r\n    \r\n    //交换两个方块的位置\r\n    exchangeBoxItem:function(boxItem1,boxItem2,toCheckViable = true){\r\n\r\n        if(boxItem1.rank === boxItem2.rank){\r\n            //同一列的\r\n            let list = this.rankList[boxItem1.rank];\r\n\r\n            //交换位置\r\n            let temp_endy = boxItem2.end_y;\r\n            boxItem2.end_y = boxItem1.end_y;\r\n            boxItem1.end_y = temp_endy;\r\n\r\n            //交换信息\r\n            let temp_row = boxItem2.row;\r\n\r\n            boxItem2.row = boxItem1.row;\r\n            boxItem1.row = temp_row;            \r\n\r\n            let temp_node = list[boxItem1.row];\r\n            list[boxItem1.row] = list[boxItem2.row];\r\n            list[boxItem2.row] = temp_node;\r\n\r\n\r\n        }else if(boxItem1.row === boxItem2.row){\r\n            //同一行的\r\n            let list1 = this.rankList[boxItem1.rank];\r\n            let list2 = this.rankList[boxItem2.rank];\r\n\r\n            //交换位置\r\n            let temp_beginx = boxItem2.begin_x;\r\n            boxItem2.begin_x = boxItem1.begin_x;\r\n            boxItem1.begin_x = temp_beginx;\r\n\r\n            //交换信息\r\n            let temp_rank = boxItem2.rank;\r\n            boxItem2.rank = boxItem1.rank;\r\n            boxItem1.rank = temp_rank;\r\n\r\n            let row_index = boxItem1.row;\r\n            let temp_node = list1[row_index];\r\n            list1[row_index] = list2[row_index];\r\n            list2[row_index] = temp_node;\r\n        }\r\n\r\n        \r\n        if(toCheckViable){\r\n\r\n            let isViable = this.checkPanelEliminatable();\r\n\r\n            if(!isViable){\r\n\r\n                //不可消除的话 位置再互换回来\r\n                console.log(\"不可消除\");\r\n                setTimeout(function() {\r\n                this.exchangeBoxItem(boxItem2,boxItem1,false); \r\n                }.bind(this), 300);\r\n            }\r\n        }\r\n    },\r\n\r\n    //检测面板所有方块 是否可消除\r\n    checkPanelEliminatable:function(){\r\n\r\n        let wipe_list = [];\r\n\r\n        //判断列 是否有三个以及三个以上的一样的色块连在一起\r\n        for (let i = 0; i<this.num_rank; i++){\r\n            let list = this.rankList[i];\r\n            let tempList = [];\r\n            let pre_box = null;\r\n            for(let j = 0; j<this.num_row; j++){\r\n                let box = list[j];\r\n                if(!pre_box){\r\n                    pre_box = box;\r\n                    tempList.push(box);\r\n                }else{\r\n                    let item_pre = pre_box.getComponent(\"BoxDrop\").boxItem;\r\n                    let item_box = box.getComponent(\"BoxDrop\").boxItem;\r\n\r\n                    let toAdd = false;\r\n                    if(item_pre.color_type === item_box.color_type){\r\n                        tempList.push(box);\r\n                        if(j == (this.num_row-1)){\r\n                            toAdd = true;\r\n                        }\r\n                    }else{\r\n                        toAdd = true;\r\n                    }\r\n\r\n                    if(toAdd){\r\n                        if(tempList.length >= 3){\r\n                            //追加到wipe里面\r\n                            Array.prototype.push.apply(wipe_list,tempList);\r\n\r\n                            tempList.forEach(function(elem){\r\n\r\n                                elem.getComponent(\"BoxDrop\").boxIsSelectState(true);\r\n\r\n                            });\r\n\r\n                        }\r\n                        //清空数组\r\n                        tempList = [];\r\n\r\n                        pre_box = box;\r\n                        tempList.push(box);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        function isRepeatItemInWipe(item){\r\n            for(let i = 0; i<wipe_list.length; i++){\r\n                if(wipe_list[i].getComponent(\"BoxDrop\").boxItem.id === item.getComponent(\"BoxDrop\").boxItem.id){\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        //判断行 是否有三个以及三个以上的一样的色块连在一起\r\n        for (let i = 0; i<this.num_row; i++){\r\n            \r\n            let tempList = [];\r\n            let pre_box = null;\r\n            for(let j = 0; j<this.num_rank; j++){\r\n                let box = this.rankList[j][i];\r\n                if(!pre_box){\r\n                    pre_box = box;\r\n                    tempList.push(box);\r\n                }else{\r\n                    let item_pre = pre_box.getComponent(\"BoxDrop\").boxItem;\r\n                    let item_box = box.getComponent(\"BoxDrop\").boxItem;\r\n\r\n                    let toAdd = false;\r\n                    if(item_pre.color_type === item_box.color_type){\r\n                        tempList.push(box);\r\n                        if(j == (this.num_rank-1)){\r\n                            toAdd = true;\r\n                        }\r\n                    }else{\r\n                        toAdd = true;\r\n                    }\r\n\r\n                    if(toAdd){\r\n                        if(tempList.length >= 3){\r\n                            //追加到wipe里面\r\n                            tempList.forEach(function(elem){\r\n\r\n                                if(!isRepeatItemInWipe(elem)){\r\n                                    wipe_list.push(elem);\r\n                                }\r\n\r\n                            });\r\n\r\n                            tempList.forEach(function(elem){\r\n\r\n                                elem.getComponent(\"BoxDrop\").boxIsSelectState(true);\r\n\r\n                            });\r\n\r\n                        }\r\n                        //清空数组\r\n                        tempList = [];\r\n\r\n                        pre_box = box;\r\n                        tempList.push(box);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        if(wipe_list.length > 0){\r\n\r\n            //消除掉\r\n            wipe_list.forEach(function(elem){\r\n\r\n                this.boxDrop_destroy(elem.getComponent(\"BoxDrop\"));\r\n\r\n            }.bind(this));\r\n\r\n            this.updateAllRankEndY();    \r\n\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    boxDrop_get:function(){\r\n\r\n        let box = null;\r\n        if(this.boxPool.size() > 0){\r\n            box = this.boxPool.get();\r\n        }else{\r\n            box = cc.instantiate(this.box_prefab);\r\n        }\r\n\r\n        return box;\r\n    },\r\n\r\n    boxDrop_destroy:function(box){\r\n\r\n        let list = this.rankList[box.boxItem.rank];\r\n        \r\n        list.removeByValue(list,box.node);\r\n\r\n        this.boxPool.put(box.node);\r\n    },\r\n\r\n\r\n\r\n    \r\n\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"
  ]
}